import{r as a,j as t}from"./index-B-j1UC9_.js";import{c as j,L as D,I as B,B as O}from"./nav-CtgBGWHp.js";import{T as v}from"./decorators-CfDSmGYB.js";import{c as E}from"./chart-data-BkDdS-S9.js";import"./createLucideIcon-BBWb6tWq.js";function w({persons:s,selectedPersonId:n,onPersonChange:d,isLoading:i=!1,label:g="Center On",placeholder:k="Search people...",className:S}){const[h,u]=a.useState(""),[o,l]=a.useState(!1),[m,N]=a.useState(0),f=a.useRef(null),p=a.useRef(null),L=a.useCallback(e=>{const r=`${e.firstName||""} ${e.lastName||""}`.trim();if(e.dateOfBirth){const x=new Date(e.dateOfBirth).getFullYear();return`${r} (b. ${x})`}return r},[]),b=a.useMemo(()=>s.find(e=>e.id===n),[s,n]),c=a.useMemo(()=>{if(!h.trim())return s;const e=h.toLowerCase();return s.filter(r=>`${r.firstName||""} ${r.lastName||""}`.toLowerCase().includes(e))},[s,h]);a.useEffect(()=>{N(0)},[c.length]),a.useEffect(()=>{if(o&&p.current){const e=p.current.children[m];e&&e.scrollIntoView({block:"nearest"})}},[m,o]);const I=a.useCallback(e=>{if(!o){(e.key==="ArrowDown"||e.key==="Enter")&&(l(!0),e.preventDefault());return}switch(e.key){case"ArrowDown":e.preventDefault(),N(r=>r<c.length-1?r+1:r);break;case"ArrowUp":e.preventDefault(),N(r=>r>0?r-1:r);break;case"Enter":e.preventDefault(),c[m]&&(d(c[m].id),u(""),l(!1));break;case"Escape":e.preventDefault(),u(""),l(!1);break;case"Tab":l(!1);break}},[o,c,m,d]),C=a.useCallback(e=>{var r;d(e),u(""),l(!1),(r=f.current)==null||r.blur()},[d]);return a.useEffect(()=>{const e=r=>{const x=r.target;f.current&&!f.current.contains(x)&&p.current&&!p.current.contains(x)&&(l(!1),u(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),i?t.jsxs("div",{className:j("space-y-2",S),children:[g&&t.jsx(D,{children:g}),t.jsx("div",{className:"bg-muted flex h-10 w-[250px] items-center justify-center rounded-md border",children:t.jsx("span",{className:"text-muted-foreground text-sm",children:"Loading..."})})]}):t.jsxs("div",{className:j("relative space-y-2",S),children:[g&&t.jsx(D,{htmlFor:"person-selector",children:g}),t.jsxs("div",{className:"relative",children:[t.jsx(B,{ref:f,id:"person-selector",type:"text",placeholder:o?k:b?L(b):k,value:h,onChange:e=>{u(e.target.value),o||l(!0)},onFocus:()=>l(!0),onKeyDown:I,className:"w-[250px]",autoComplete:"off","aria-expanded":o,"aria-haspopup":"listbox","aria-autocomplete":"list",role:"combobox"}),b&&!o&&!h&&t.jsxs(O,{type:"button",variant:"ghost",size:"sm",className:"absolute top-1/2 right-1 h-7 w-7 -translate-y-1/2 p-0",onClick:()=>{var e;u(""),l(!0),(e=f.current)==null||e.focus()},children:[t.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})}),t.jsx("span",{className:"sr-only",children:"Open dropdown"})]})]}),o&&t.jsx("ul",{ref:p,className:"bg-popover border-border absolute z-50 mt-1 max-h-[300px] w-[250px] overflow-auto rounded-md border shadow-lg",role:"listbox","aria-label":"People",children:c.length===0?t.jsx("li",{className:"text-muted-foreground px-3 py-2 text-sm",children:"No people found"}):c.map((e,r)=>t.jsxs("li",{role:"option","aria-selected":e.id===n,className:j("flex cursor-pointer items-center gap-2 px-3 py-2 text-sm","hover:bg-accent hover:text-accent-foreground",r===m&&"bg-accent text-accent-foreground",e.id===n&&"font-medium"),onClick:()=>C(e.id),onMouseEnter:()=>N(r),children:[t.jsx("span",{className:j("h-2 w-2 shrink-0 rounded-full",e.isLiving?"bg-primary":"bg-muted-foreground"),title:e.isLiving?"Living":"Deceased"}),t.jsx("span",{className:"truncate",children:L(e)}),e.id===n&&t.jsx("svg",{className:"text-primary ml-auto h-4 w-4 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},e.id))})]})}const J={title:"Charts/UI/PersonSelector"},y=E(20,{generations:4}).map(s=>({id:s.id,firstName:s.firstName,lastName:s.lastName,dateOfBirth:s.dateOfBirth?new Date(s.dateOfBirth):null,isLiving:s.isLiving})),P=()=>{const[s,n]=a.useState(y[0].id);return t.jsx(v,{children:t.jsxs("div",{className:"p-8",children:[t.jsx(w,{persons:y,selectedPersonId:s,onPersonChange:n}),t.jsxs("p",{className:"text-muted-foreground mt-4 text-sm",children:["Selected ID: ",s||"None"]})]})})};P.storyName="Default - Standard selector";const M=()=>{const[s,n]=a.useState();return t.jsx(v,{children:t.jsxs("div",{className:"p-8",children:[t.jsx(w,{persons:[],selectedPersonId:s,onPersonChange:n}),t.jsx("p",{className:"text-muted-foreground mt-4 text-sm",children:"No people available"})]})})};M.storyName="Empty - No people available";const $=()=>{const s=E(100,{generations:10}).map(i=>({id:i.id,firstName:i.firstName,lastName:i.lastName,dateOfBirth:i.dateOfBirth?new Date(i.dateOfBirth):null,isLiving:i.isLiving})),[n,d]=a.useState(s[0].id);return t.jsx(v,{children:t.jsxs("div",{className:"p-8",children:[t.jsx(w,{persons:s,selectedPersonId:n,onPersonChange:d}),t.jsxs("p",{className:"text-muted-foreground mt-4 text-sm",children:[s.length," people in list"]})]})})};$.storyName="Many People - Long list";const R=()=>{const[s,n]=a.useState();return t.jsx(v,{children:t.jsxs("div",{className:"p-8",children:[t.jsx(w,{persons:y,selectedPersonId:s,onPersonChange:n,placeholder:"Type to search..."}),t.jsx("p",{className:"text-muted-foreground mt-4 text-sm",children:'Try searching for "John", "Jane", or "Bob"'})]})})};R.storyName="With Search - Search functionality";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{P as Default,M as Empty,$ as ManyPeople,R as WithSearch,J as default};
