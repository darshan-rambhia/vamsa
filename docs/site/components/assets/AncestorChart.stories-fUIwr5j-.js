import{r as a,j as t}from"./index-B-j1UC9_.js";import{s as Q,c as U,g as ee,r as te,a as oe,b as se,f as ne}from"./d3-utils-RO1_HbsM.js";import{u as re,a as ae,b as ie}from"./chart-performance-BaH3yzFL.js";import{C as ce}from"./ChartTooltip-O9xYVHal.js";import{C as de}from"./ChartSkeleton-B4IOvdG_.js";import{u as le}from"./useNavigate-C7g4pSHn.js";import{S as g}from"./decorators-CfDSmGYB.js";import{S as D,c as H,a as k,D as L,b as W,r as B}from"./chart-data-BkDdS-S9.js";import"./zoom-BhWAVBVM.js";import"./string-Quv1MC-p.js";import"./nav-CtgBGWHp.js";import"./createLucideIcon-BBWb6tWq.js";function ue({nodes:e,edges:i,onNodeClick:n,rootPersonId:V}){var T;const d=a.useRef(null),y=a.useRef(null),_=le(),[$,j]=a.useState(!0),[l,f]=a.useState(null);re("AncestorChart",!1);const S=ae(e.length),v=ie(()=>{},16),A=a.useMemo(()=>({nodeWidth:180,nodeHeight:60,levelHeight:120,margin:{top:40,right:40,bottom:40,left:40}}),[]);a.useEffect(()=>{if(!d.current||!y.current||e.length===0)return;performance.now(),j(!0);const u=setTimeout(()=>{const G=y.current;if(!G||!d.current)return;const w=G.clientWidth,P=Math.max(600,e.length*80),b=Q(d,w,P);if(!b)return;const{svg:I,g:h}=b,z=U(I,h,[.1,4],v),{nodeWidth:c,nodeHeight:E,levelHeight:F,margin:N}=A,O=ee(e),x=new Map;O.forEach((o,s)=>{const r=N.top+s*F,m=o.length*c*1.5,C=(w-m)/2;o.forEach((q,J)=>{const K=C+J*c*1.5+c/2;x.set(q.id,{x:K,y:r})})});const M=h.append("g").attr("class","edges");i.forEach(o=>{const s=x.get(o.source),r=x.get(o.target);!s||!r||(o.type==="parent-child"?te(M,s,r,E):o.type==="spouse"&&oe(M,s,r,c))});const X=h.append("g").attr("class","nodes");e.forEach(o=>{const s=x.get(o.id);if(!s)return;const r=X.append("g").attr("class","node").attr("transform",`translate(${s.x-c/2}, ${s.y-E/2})`).style("cursor","pointer").on("click",()=>n==null?void 0:n(o.id)).on("mouseover",()=>{var C;const m=(C=d.current)==null?void 0:C.getBoundingClientRect();m&&f({node:o,position:{x:m.left+s.x,y:m.top+s.y}})}).on("mouseout",()=>{f(null)});se(r,o,s,{width:c,height:E,borderRadius:8})}),ne(I,h,z,w,P,N),performance.now(),j(!1)},0);return()=>clearTimeout(u)},[e,i,n,A,v]);const Z=u=>{_({to:"/people/$personId",params:{personId:u}}),f(null)},Y=u=>{n==null||n(u),f(null)},R=V||((T=e[0])==null?void 0:T.id);return $&&S.isLoading?t.jsx(de,{message:S.message||void 0,estimatedTime:S.estimatedTime}):t.jsxs("div",{ref:y,className:"bg-card relative h-full w-full overflow-hidden rounded-lg border",children:[t.jsx("svg",{ref:d,className:"h-full w-full"}),l&&R&&t.jsx(ce,{node:l.node,position:l.position,rootPersonId:R,onSetAsCenter:Y,onViewProfile:Z,relationshipLabel:l.node.generation?`Generation ${l.node.generation}`:void 0})]})}const p=a.memo(ue),Pe={title:"Charts/AncestorChart"},me=()=>t.jsx(g,{children:t.jsx(p,{nodes:D.nodes,edges:D.edges,onNodeClick:e=>console.log("Clicked:",e)})});me.storyName="Default - 3 Generations";const ge=()=>{B();const e=H(15,{generations:3}),i=k(e);return t.jsx(g,{children:t.jsx(p,{nodes:e,edges:i,onNodeClick:n=>console.log("Clicked:",n)})})};ge.storyName="Three Generations - Basic View";const pe=()=>t.jsx(g,{children:t.jsx(p,{nodes:L.nodes,edges:L.edges,onNodeClick:e=>console.log("Clicked:",e)})});pe.storyName="Ten Generations - Deep Ancestry";const fe=()=>{B();const e=H(12,{generations:3}),i=k(e);return t.jsx(g,{children:t.jsx(p,{nodes:e,edges:i,onNodeClick:n=>console.log("Clicked:",n)})})};fe.storyName="With Spouses - Include Relationships";const he=()=>t.jsx(g,{children:t.jsx(p,{nodes:W.nodes,edges:W.edges,onNodeClick:e=>console.log("Clicked:",e)})});he.storyName="No Ancestors - Single Person";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{me as Default,he as NoAncestors,pe as TenGenerations,ge as ThreeGenerations,fe as WithSpouses,Pe as default};
