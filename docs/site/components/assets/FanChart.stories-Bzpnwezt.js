import{r as K,j as $}from"./index-B-j1UC9_.js";import"./zoom-BhWAVBVM.js";import{s as me,c as ye,g as he,d as xe,e as ve}from"./d3-utils-RO1_HbsM.js";import{u as Re,a as Ae,b as we}from"./chart-performance-BaH3yzFL.js";import{C as Se}from"./ChartTooltip-O9xYVHal.js";import{C as Te}from"./ChartSkeleton-B4IOvdG_.js";import{u as Ce}from"./useNavigate-C7g4pSHn.js";import{p as Me}from"./path-DKbKBQE1.js";import{w as je,p as ae,c as J,s as Z,a as q,h as ie,e as k,t as Ee,b as ee,m as re,d as ue,f as T,g as le,i as Ge,j as ke}from"./path-C_xR0TQQ.js";import{S as ne}from"./decorators-CfDSmGYB.js";import{S as ce,c as fe,a as pe,b as de,r as ge}from"./chart-data-BkDdS-S9.js";import"./string-Quv1MC-p.js";import"./nav-CtgBGWHp.js";import"./createLucideIcon-BBWb6tWq.js";function Pe(n){return n.innerRadius}function Ie(n){return n.outerRadius}function be(n){return n.startAngle}function Fe(n){return n.endAngle}function $e(n){return n&&n.padAngle}function De(n,m,d,D,x,C,N,r){var L=d-n,a=D-m,e=N-x,v=r-C,s=v*L-e*a;if(!(s*s<k))return s=(e*(m-C)-v*(n-x))/s,[n+s*L,m+s*a]}function te(n,m,d,D,x,C,N){var r=n-d,L=m-D,a=(N?C:-C)/ee(r*r+L*L),e=a*L,v=-a*r,s=n+e,u=m+v,R=d+e,A=D+v,B=(s+R)/2,l=(u+A)/2,y=R-s,w=A-u,S=y*y+w*w,j=x-C,P=s*A-R*u,V=(w<0?-1:1)*ee(Ge(0,j*j*S-P*P)),E=(P*w-y*V)/S,O=(-P*y-w*V)/S,h=(P*w+y*V)/S,f=(-P*y+w*V)/S,M=E-B,t=O-l,o=h-B,W=f-l;return M*M+t*t>o*o+W*W&&(E=h,O=f),{cx:E,cy:O,x01:-e,y01:-v,x11:E*(x/j-1),y11:O*(x/j-1)}}function Le(){var n=Pe,m=Ie,d=q(0),D=null,x=be,C=Fe,N=$e,r=null,L=je(a);function a(){var e,v,s=+n.apply(this,arguments),u=+m.apply(this,arguments),R=x.apply(this,arguments)-ie,A=C.apply(this,arguments)-ie,B=ue(A-R),l=A>R;if(r||(r=e=L()),u<s&&(v=u,u=s,s=v),!(u>k))r.moveTo(0,0);else if(B>Ee-k)r.moveTo(u*J(R),u*Z(R)),r.arc(0,0,u,R,A,!l),s>k&&(r.moveTo(s*J(A),s*Z(A)),r.arc(0,0,s,A,R,l));else{var y=R,w=A,S=R,j=A,P=B,V=B,E=N.apply(this,arguments)/2,O=E>k&&(D?+D.apply(this,arguments):ee(s*s+u*u)),h=re(ue(u-s)/2,+d.apply(this,arguments)),f=h,M=h,t,o;if(O>k){var W=le(O/s*Z(E)),z=le(O/u*Z(E));(P-=W*2)>k?(W*=l?1:-1,S+=W,j-=W):(P=0,S=j=(R+A)/2),(V-=z*2)>k?(z*=l?1:-1,y+=z,w-=z):(V=0,y=w=(R+A)/2)}var X=u*J(y),I=u*Z(y),Q=s*J(j),Y=s*Z(j);if(h>k){var U=u*J(w),c=u*Z(w),i=s*J(S),g=s*Z(S),p;if(B<ae)if(p=De(X,I,i,g,U,c,Q,Y)){var G=X-p[0],b=I-p[1],F=U-p[0],H=c-p[1],_=1/Z(ke((G*F+b*H)/(ee(G*G+b*b)*ee(F*F+H*H)))/2),oe=ee(p[0]*p[0]+p[1]*p[1]);f=re(h,(s-oe)/(_-1)),M=re(h,(u-oe)/(_+1))}else f=M=0}V>k?M>k?(t=te(i,g,X,I,u,M,l),o=te(U,c,Q,Y,u,M,l),r.moveTo(t.cx+t.x01,t.cy+t.y01),M<h?r.arc(t.cx,t.cy,M,T(t.y01,t.x01),T(o.y01,o.x01),!l):(r.arc(t.cx,t.cy,M,T(t.y01,t.x01),T(t.y11,t.x11),!l),r.arc(0,0,u,T(t.cy+t.y11,t.cx+t.x11),T(o.cy+o.y11,o.cx+o.x11),!l),r.arc(o.cx,o.cy,M,T(o.y11,o.x11),T(o.y01,o.x01),!l))):(r.moveTo(X,I),r.arc(0,0,u,y,w,!l)):r.moveTo(X,I),!(s>k)||!(P>k)?r.lineTo(Q,Y):f>k?(t=te(Q,Y,U,c,s,-f,l),o=te(X,I,i,g,s,-f,l),r.lineTo(t.cx+t.x01,t.cy+t.y01),f<h?r.arc(t.cx,t.cy,f,T(t.y01,t.x01),T(o.y01,o.x01),!l):(r.arc(t.cx,t.cy,f,T(t.y01,t.x01),T(t.y11,t.x11),!l),r.arc(0,0,s,T(t.cy+t.y11,t.cx+t.x11),T(o.cy+o.y11,o.cx+o.x11),l),r.arc(o.cx,o.cy,f,T(o.y11,o.x11),T(o.y01,o.x01),!l))):r.arc(0,0,s,j,S,l)}if(r.closePath(),e)return r=null,e+""||null}return a.centroid=function(){var e=(+n.apply(this,arguments)+ +m.apply(this,arguments))/2,v=(+x.apply(this,arguments)+ +C.apply(this,arguments))/2-ae/2;return[J(v)*e,Z(v)*e]},a.innerRadius=function(e){return arguments.length?(n=typeof e=="function"?e:q(+e),a):n},a.outerRadius=function(e){return arguments.length?(m=typeof e=="function"?e:q(+e),a):m},a.cornerRadius=function(e){return arguments.length?(d=typeof e=="function"?e:q(+e),a):d},a.padRadius=function(e){return arguments.length?(D=e==null?null:typeof e=="function"?e:q(+e),a):D},a.startAngle=function(e){return arguments.length?(x=typeof e=="function"?e:q(+e),a):x},a.endAngle=function(e){return arguments.length?(C=typeof e=="function"?e:q(+e),a):C},a.padAngle=function(e){return arguments.length?(N=typeof e=="function"?e:q(+e),a):N},a.context=function(e){return arguments.length?(r=e??null,a):r},a}function Ve({nodes:n,edges:m,onNodeClick:d,rootPersonId:D}){var l;const x=K.useRef(null),C=K.useRef(null),N=Ce(),[r,L]=K.useState(!0),[a,e]=K.useState(null);Re("FanChart",!1);const v=Ae(n.length),s=we(()=>{},16),u=K.useMemo(()=>({innerRadius:80,radiusStep:100,nodeRadius:35,margin:{top:40,right:40,bottom:40,left:40}}),[]);K.useEffect(()=>{if(!x.current||!C.current||n.length===0)return;performance.now(),L(!0);const y=setTimeout(()=>{const w=C.current;if(!w||!x.current)return;const S=w.clientWidth,j=Math.max(600,S),P=me(x,S,j);if(!P)return;const{svg:V,g:E}=P,O=ye(V,E,[.1,4],s),h=S/2,f=j/2,{innerRadius:M,radiusStep:t,nodeRadius:o,margin:W}=u,z=he(n),X=Math.max(...Array.from(z.keys())),I=new Map;z.forEach((c,i)=>{const g=i===0?0:M+i*t,p=i===0?0:2*Math.PI/c.length;c.forEach((G,b)=>{if(i===0)if(c.length===1)I.set(G.id,{x:h,y:f,angle:0,radius:0});else{const F=o*2.5,H=(c.length-1)*F,_=h-H/2;I.set(G.id,{x:_+b*F,y:f,angle:0,radius:0})}else{const F=-Math.PI/2+b*p,H=h+g*Math.cos(F),_=f+g*Math.sin(F);I.set(G.id,{x:H,y:_,angle:F,radius:g})}})});const Q=E.append("g").attr("class","guides").attr("opacity",.1);for(let c=1;c<=X;c++){const i=M+c*t;Q.append("circle").attr("cx",h).attr("cy",f).attr("r",i).attr("fill","none").style("stroke","var(--color-border)").style("stroke-width","1px").style("stroke-dasharray","5,5")}const Y=E.append("g").attr("class","edges");m.forEach(c=>{const i=I.get(c.source),g=I.get(c.target);if(!(!i||!g)){if(c.type==="parent-child"){const p=Me();p.moveTo(i.x,i.y),p.lineTo(g.x,g.y),Y.append("path").attr("d",p.toString()).style("stroke","var(--color-border)").style("stroke-width","2px").style("fill","none")}else if(c.type==="spouse"){if(i.radius===0&&g.radius===0)Y.append("line").attr("x1",i.x).attr("y1",i.y).attr("x2",g.x).attr("y2",g.y).style("stroke","var(--color-primary)").style("stroke-width","2px").style("stroke-dasharray","5,5");else if(i.radius===g.radius&&i.radius>0){const p=i.radius,G=Math.atan2(i.y-f,i.x-h),b=Math.atan2(g.y-f,g.x-h),F=Le().innerRadius(p).outerRadius(p).startAngle(G).endAngle(b);Y.append("path").attr("d",F({startAngle:G,endAngle:b})).attr("transform",`translate(${h}, ${f})`).style("stroke","var(--color-primary)").style("stroke-width","2px").style("stroke-dasharray","5,5").style("fill","none")}}}});const U=E.append("g").attr("class","nodes");n.forEach(c=>{const i=I.get(c.id);if(!i)return;const g=(c.generation??0)===0,p=U.append("g").attr("class","node").attr("transform",`translate(${i.x}, ${i.y})`).style("cursor","pointer").on("click",()=>d==null?void 0:d(c.id)).on("mouseover",()=>{var b;const G=(b=x.current)==null?void 0:b.getBoundingClientRect();G&&e({node:c,position:{x:G.left+i.x,y:G.top+i.y}})}).on("mouseout",()=>{e(null)});xe(p,c,{radius:o,isRoot:g})}),ve(V,E,O,S,j,W),performance.now(),L(!1)},0);return()=>clearTimeout(y)},[n,m,d,u,s]);const R=y=>{N({to:"/people/$personId",params:{personId:y}}),e(null)},A=y=>{d==null||d(y),e(null)},B=D||((l=n[0])==null?void 0:l.id);return r&&v.isLoading?$.jsx(Te,{message:v.message||void 0,estimatedTime:v.estimatedTime}):$.jsxs("div",{ref:C,className:"bg-card relative h-full w-full overflow-hidden rounded-lg border",children:[$.jsx("svg",{ref:x,className:"h-full w-full"}),a&&B&&$.jsx(Se,{node:a.node,position:a.position,rootPersonId:B,onSetAsCenter:A,onViewProfile:R,relationshipLabel:a.node.generation?`Generation ${a.node.generation}`:void 0})]})}const se=K.memo(Ve),st={title:"Charts/FanChart"},Be=()=>$.jsx(ne,{children:$.jsx(se,{nodes:ce.nodes,edges:ce.edges,onNodeClick:n=>console.log("Clicked:",n)})});Be.storyName="Default - 4 Generations";const Oe=()=>{ge();const n=fe(20,{generations:4}),m=pe(n);return $.jsx(ne,{children:$.jsx(se,{nodes:n,edges:m,onNodeClick:d=>console.log("Clicked:",d)})})};Oe.storyName="Four Generations - Standard Fan View";const Ze=()=>{ge();const n=fe(40,{generations:8}),m=pe(n);return $.jsx(ne,{children:$.jsx(se,{nodes:n,edges:m,onNodeClick:d=>console.log("Clicked:",d)})})};Ze.storyName="Eight Generations - Deep Ancestry Fan";const Ne=()=>$.jsx(ne,{children:$.jsx(se,{nodes:de.nodes,edges:de.edges,onNodeClick:n=>console.log("Clicked:",n)})});Ne.storyName="Single Ancestor - Minimal Data";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{Be as Default,Ze as EightGenerations,Oe as FourGenerations,Ne as SingleAncestor,st as default};
