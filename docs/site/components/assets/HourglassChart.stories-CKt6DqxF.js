import{r as g,j as i}from"./index-B-j1UC9_.js";import{s as V,c as Y,g as _,r as F,b as J,e as K}from"./d3-utils-RO1_HbsM.js";import{u as O,a as Q,b as tt}from"./chart-performance-BaH3yzFL.js";import{C as et}from"./ChartSkeleton-B4IOvdG_.js";import{S as C}from"./decorators-CfDSmGYB.js";import{e as k,a as ot,r as st}from"./chart-data-BkDdS-S9.js";import"./zoom-BhWAVBVM.js";import"./string-Quv1MC-p.js";import"./createLucideIcon-BBWb6tWq.js";function nt({nodes:o,edges:a,rootPersonId:n,onNodeClick:r}){const u=g.useRef(null),f=g.useRef(null),[j,s]=g.useState(!0);O("HourglassChart",!1);const m=Q(o.length),l=tt(()=>{},16),D=g.useMemo(()=>({nodeWidth:180,nodeHeight:60,levelHeight:120,margin:{top:40,right:40,bottom:40,left:40}}),[]);return g.useEffect(()=>{if(!u.current||!f.current||o.length===0)return;performance.now(),s(!0);const Z=setTimeout(()=>{const R=f.current;if(!R||!u.current)return;const p=R.clientWidth,H=Math.max(800,o.length*60),A=V(u,p,H);if(!A)return;const{svg:S,g:x}=A,X=Y(S,x,[.1,4],l),{nodeWidth:d,nodeHeight:M,levelHeight:B,margin:q}=D,$=o.find(t=>t.id===n),T=[],W=[];o.forEach(t=>{t.id!==n&&(t.generation&&t.generation>0?T.push(t):W.push(t))});const z=_(T),w=new Map;W.forEach(t=>{const e=Math.abs(t.generation??0);w.has(e)||w.set(e,[]),w.get(e).push(t)});const h=new Map,G=H/2;$&&h.set($.id,{x:p/2,y:G}),z.forEach((t,e)=>{const c=G-e*B,y=t.length*d*1.5,b=(p-y)/2;t.forEach((I,N)=>{const P=b+N*d*1.5+d/2;h.set(I.id,{x:P,y:c})})}),w.forEach((t,e)=>{if(e===0)return;const c=G+e*B,y=t.length*d*1.5,b=(p-y)/2;t.forEach((I,N)=>{const P=b+N*d*1.5+d/2;h.set(I.id,{x:P,y:c})})});const L=x.append("g").attr("class","edges");a.forEach(t=>{const e=h.get(t.source),c=h.get(t.target);!e||!c||(t.type==="parent-child"?F(L,e,c,M):t.type==="spouse"&&L.append("line").attr("x1",Math.min(e.x,c.x)+d/2).attr("y1",e.y).attr("x2",Math.max(e.x,c.x)-d/2).attr("y2",c.y).style("stroke","var(--color-primary)").style("stroke-width","2px").style("stroke-dasharray","5,5"))});const U=x.append("g").attr("class","nodes");o.forEach(t=>{const e=h.get(t.id);if(!e)return;const c=t.id===n,y=U.append("g").attr("class","node").attr("transform",`translate(${e.x-d/2}, ${e.y-M/2})`).style("cursor","pointer").on("click",()=>r==null?void 0:r(t.id));J(y,t,e,{width:d,height:M,borderRadius:8,isRoot:c})}),K(S,x,X,p,H,q,.9),performance.now(),s(!1)},0);return()=>clearTimeout(Z)},[o,a,n,r,D,l]),j&&m.isLoading?i.jsx(et,{message:m.message||void 0,estimatedTime:m.estimatedTime}):i.jsx("div",{ref:f,className:"bg-card relative h-full w-full overflow-hidden rounded-lg border",children:i.jsx("svg",{ref:u,className:"h-full w-full"})})}const v=g.memo(nt),xt={title:"Charts/HourglassChart"};function E(o,a){st();const n=k({firstName:"Center",lastName:"Person",generation:0}),r=[];for(let s=1;s<=o;s++){const m=Math.pow(2,s-1);for(let l=0;l<m;l++)r.push(k({firstName:`Ancestor${s}`,lastName:`Gen${s}`,generation:s,isLiving:!1}))}const u=[];for(let s=1;s<=a;s++){const m=Math.pow(2,s-1);for(let l=0;l<m;l++)u.push(k({firstName:`Descendant${s}`,lastName:`Gen${s}`,generation:-s,isLiving:s<=2}))}const f=[n,...r,...u],j=ot(f);return{nodes:f,edges:j,rootId:n.id}}const rt=()=>{const{nodes:o,edges:a,rootId:n}=E(3,3);return i.jsx(C,{children:i.jsx(v,{nodes:o,edges:a,rootPersonId:n,onNodeClick:r=>console.log("Clicked:",r)})})};rt.storyName="Default - Balanced Ancestors and Descendants";const at=()=>{const{nodes:o,edges:a,rootId:n}=E(4,4);return i.jsx(C,{children:i.jsx(v,{nodes:o,edges:a,rootPersonId:n,onNodeClick:r=>console.log("Clicked:",r)})})};at.storyName="Balanced - Equal Generations Both Directions";const ct=()=>{const{nodes:o,edges:a,rootId:n}=E(6,2);return i.jsx(C,{children:i.jsx(v,{nodes:o,edges:a,rootPersonId:n,onNodeClick:r=>console.log("Clicked:",r)})})};ct.storyName="Heavy Ancestors - More Ancestors than Descendants";const it=()=>{const{nodes:o,edges:a,rootId:n}=E(2,5);return i.jsx(C,{children:i.jsx(v,{nodes:o,edges:a,rootPersonId:n,onNodeClick:r=>console.log("Clicked:",r)})})};it.storyName="Asymmetric - Uneven Distribution";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{it as Asymmetric,at as Balanced,rt as Default,ct as HeavyAncestors,xt as default};
