import{r as P,j as i}from"./index-B-j1UC9_.js";import{s as b,z as Q,i as U}from"./zoom-BhWAVBVM.js";import{u as V,a as tt,b as et}from"./chart-performance-BaH3yzFL.js";import{C as rt}from"./ChartSkeleton-B4IOvdG_.js";import{p as ot}from"./path-DKbKBQE1.js";import{S as B}from"./decorators-CfDSmGYB.js";import{d as O,e as at}from"./chart-data-BkDdS-S9.js";import"./string-Quv1MC-p.js";import"./createLucideIcon-BBWb6tWq.js";function nt({nodes:o,edges:l,rootPersonId:n,onNodeClick:z}){const N=P.useRef(null),R=P.useRef(null),[Y,T]=P.useState(!0);V("BowtieChart",!1);const S=tt(o.length),G=et(()=>{},16),D=P.useMemo(()=>({nodeWidth:160,nodeHeight:50,levelHeight:100,horizontalGap:80}),[]);return P.useEffect(()=>{if(!N.current||!R.current||o.length===0)return;performance.now(),T(!0);const X=setTimeout(()=>{var W;const $=R.current;if(!$||!N.current)return;const k=$.clientWidth,C=Math.max(600,o.length*80);b(N.current).selectAll("*").remove();const A=b(N.current).attr("width",k).attr("height",C).attr("viewBox",[0,0,k,C]),y=A.append("g"),H=Q().scaleExtent([.1,4]).on("zoom",t=>{y.attr("transform",t.transform.toString()),G()});A.call(H);const{nodeWidth:s,nodeHeight:h,levelHeight:x,horizontalGap:p}=D,m=k/2,u=C/2,Z=o.filter(t=>t.side==="paternal"),J=o.filter(t=>t.side==="maternal"),F=o.find(t=>t.id===n),v=new Map,M=new Map;Z.forEach(t=>{const e=t.generation??0;v.has(e)||v.set(e,[]),v.get(e).push(t)}),J.forEach(t=>{const e=t.generation??0;M.has(e)||M.set(e,[]),M.get(e).push(t)});const w=new Map;F&&w.set(F.id,{x:m,y:u}),v.forEach((t,e)=>{var d;const r=u-e*x,c=(((d=v.get(e))==null?void 0:d.length)||1)*(s+p/2),a=m-p-c;t.forEach((j,E)=>{const K=a+E*(s+p/2)+s/2;w.set(j.id,{x:K,y:r})})}),M.forEach((t,e)=>{const r=u-e*x,c=m+p;t.forEach((a,d)=>{const j=c+d*(s+p/2)+s/2;w.set(a.id,{x:j,y:r})})});const I=y.append("g").attr("class","labels");I.append("text").attr("x",m-p*2).attr("y",u-x*.5).attr("text-anchor","middle").style("fill","var(--color-chart-1)").style("font-size","14px").style("font-weight","700").style("letter-spacing","2px").text("PATERNAL"),I.append("text").attr("x",m+p*2).attr("y",u-x*.5).attr("text-anchor","middle").style("fill","var(--color-chart-3)").style("font-size","14px").style("font-weight","700").style("letter-spacing","2px").text("MATERNAL"),y.append("line").attr("x1",m).attr("x2",m).attr("y1",u-(Math.max(v.size,M.size)+1)*x).attr("y2",u+x/2).style("stroke","var(--color-border)").style("stroke-width","2px").style("stroke-dasharray","8,4").style("opacity",.5);const _=y.append("g").attr("class","edges");l.forEach(t=>{const e=w.get(t.source),r=w.get(t.target);if(!e||!r)return;const c=(e.y+r.y)/2,a=ot();a.moveTo(e.x,e.y+h/2),a.bezierCurveTo(e.x,c,r.x,c,r.x,r.y-h/2),_.append("path").attr("d",a.toString()).style("stroke","var(--color-border)").style("stroke-width","2px").style("fill","none")});const q=y.append("g").attr("class","nodes");o.forEach(t=>{const e=w.get(t.id);if(!e)return;const r=t.id===n,c=t.side==="paternal"?"var(--color-chart-1)":t.side==="maternal"?"var(--color-chart-3)":"var(--color-primary)",a=q.append("g").attr("class","node").attr("transform",`translate(${e.x-s/2}, ${e.y-h/2})`).style("cursor","pointer").on("click",()=>z==null?void 0:z(t.id));a.append("rect").attr("width",s).attr("height",h).attr("rx",r?12:8).style("fill",r?"color-mix(in oklch, var(--color-primary) 15%, transparent)":t.isLiving?"var(--color-card)":"var(--color-muted)").style("stroke",r?"var(--color-primary)":c).style("stroke-width",r?"3px":"2px").on("mouseenter",function(){b(this).transition().duration(200).style("fill","var(--color-accent)")}).on("mouseleave",function(){b(this).transition().duration(200).style("fill",r?"color-mix(in oklch, var(--color-primary) 15%, transparent)":t.isLiving?"var(--color-card)":"var(--color-muted)")}),r||a.append("rect").attr("x",0).attr("y",0).attr("width",4).attr("height",h).attr("rx",2).style("fill",c);const d=`${t.firstName} ${t.lastName}`,j=d.length>20?d.substring(0,18)+"...":d;a.append("text").attr("x",s/2).attr("y",h/2-6).attr("text-anchor","middle").style("fill","var(--color-foreground)").style("font-size","12px").style("font-weight",r?"700":"600").text(j);const E=[];t.dateOfBirth&&E.push(new Date(t.dateOfBirth).getFullYear()),t.dateOfPassing&&E.push(new Date(t.dateOfPassing).getFullYear()),E.length>0&&a.append("text").attr("x",s/2).attr("y",h/2+10).attr("text-anchor","middle").style("fill","var(--color-muted-foreground)").style("font-size","10px").text(E.join(" - ")),a.append("circle").attr("cx",s-12).attr("cy",12).attr("r",4).style("fill",t.isLiving?"var(--color-primary)":"var(--color-muted-foreground)"),t.gender&&a.append("text").attr("x",s-24).attr("y",15).style("fill","var(--color-muted-foreground)").style("font-size","10px").text(t.gender==="MALE"?"M":t.gender==="FEMALE"?"F":"")});const g=(W=y.node())==null?void 0:W.getBBox();if(g){const e=Math.min(k/(g.width+120),C/(g.height+120),.9),r=U.translate(k/2,C/2).scale(e).translate(-(g.x+g.width/2),-(g.y+g.height/2));A.transition().duration(750).call(H.transform,r)}performance.now(),T(!1)},0);return()=>clearTimeout(X)},[o,l,n,z,D,G]),Y&&S.isLoading?i.jsx(rt,{message:S.message||void 0,estimatedTime:S.estimatedTime}):i.jsx("div",{ref:R,className:"bg-card relative h-full w-full overflow-hidden rounded-lg border",children:i.jsx("svg",{ref:N,className:"h-full w-full"})})}const L=P.memo(nt),vt={title:"Charts/BowtieChart"},f=at({id:"root-1",firstName:"John",lastName:"Center",gender:"MALE",isLiving:!0,generation:0,dateOfBirth:"1980-01-01"}),st=()=>{const{nodes:o,edges:l}=O(f,6,6);return i.jsx(B,{children:i.jsx(L,{nodes:o,edges:l,rootPersonId:f.id,onNodeClick:n=>console.log("Clicked:",n)})})};st.storyName="Default - Balanced paternal/maternal";const it=()=>{const{nodes:o,edges:l}=O(f,8,0);return i.jsx(B,{children:i.jsx(L,{nodes:o,edges:l,rootPersonId:f.id,onNodeClick:n=>console.log("Clicked:",n)})})};it.storyName="Paternal Only - Only father's side";const lt=()=>{const{nodes:o,edges:l}=O(f,0,8);return i.jsx(B,{children:i.jsx(L,{nodes:o,edges:l,rootPersonId:f.id,onNodeClick:n=>console.log("Clicked:",n)})})};lt.storyName="Maternal Only - Only mother's side";const ct=()=>{const{nodes:o,edges:l}=O(f,4,0);return i.jsx(B,{children:i.jsx(L,{nodes:o,edges:l,rootPersonId:f.id,onNodeClick:n=>console.log("Clicked:",n)})})};ct.storyName="Single Parent - One parent known";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{st as Default,lt as MaternalOnly,it as PaternalOnly,ct as SingleParent,vt as default};
