import{r as a,j as n}from"./index-B-j1UC9_.js";import{s as q,c as J,g as K,r as Q,a as U,b as ee,f as te}from"./d3-utils-RO1_HbsM.js";import{u as oe,a as ne,b as se}from"./chart-performance-BaH3yzFL.js";import{C as re}from"./ChartTooltip-O9xYVHal.js";import{C as ae}from"./ChartSkeleton-B4IOvdG_.js";import{u as ie}from"./useNavigate-C7g4pSHn.js";import{S as x}from"./decorators-CfDSmGYB.js";import{S as L,c as ce,a as de,D as A,b as H,r as le}from"./chart-data-BkDdS-S9.js";import"./zoom-BhWAVBVM.js";import"./string-Quv1MC-p.js";import"./nav-CtgBGWHp.js";import"./createLucideIcon-BBWb6tWq.js";function ue({nodes:e,edges:m,onNodeClick:s,rootPersonId:B}){var T;const c=a.useRef(null),w=a.useRef(null),V=ie(),[W,v]=a.useState(!0),[d,g]=a.useState(null);oe("DescendantChart",!1);const y=ne(e.length),j=se(()=>{},16),G=a.useMemo(()=>({nodeWidth:180,nodeHeight:60,levelHeight:120,margin:{top:40,right:40,bottom:40,left:40}}),[]);a.useEffect(()=>{if(!c.current||!w.current||e.length===0)return;performance.now(),v(!0);const l=setTimeout(()=>{const D=w.current;if(!D||!c.current)return;const E=D.clientWidth,P=Math.max(600,e.length*80),b=q(c,E,P);if(!b)return;const{svg:I,g:f}=b,Z=J(I,f,[.1,4],j),{nodeWidth:i,nodeHeight:S,levelHeight:k,margin:M}=G,Y=K(e),p=new Map;Y.forEach((t,o)=>{const r=M.top+o*k,u=t.length*i*1.5,h=(E-u)/2;t.forEach((F,O)=>{const X=h+O*i*1.5+i/2;p.set(F.id,{x:X,y:r})})});const N=f.append("g").attr("class","edges");m.forEach(t=>{const o=p.get(t.source),r=p.get(t.target);!o||!r||(t.type==="parent-child"?Q(N,o,r,S):t.type==="spouse"&&U(N,o,r,i))});const z=f.append("g").attr("class","nodes");e.forEach(t=>{const o=p.get(t.id);if(!o)return;const r=z.append("g").attr("class","node").attr("transform",`translate(${o.x-i/2}, ${o.y-S/2})`).style("cursor","pointer").on("click",()=>s==null?void 0:s(t.id)).on("mouseover",()=>{var h;const u=(h=c.current)==null?void 0:h.getBoundingClientRect();u&&g({node:t,position:{x:u.left+o.x,y:u.top+o.y}})}).on("mouseout",()=>{g(null)});ee(r,t,o,{width:i,height:S,borderRadius:8})}),te(I,f,Z,E,P,M),performance.now(),v(!1)},0);return()=>clearTimeout(l)},[e,m,s,G,j]);const _=l=>{V({to:"/people/$personId",params:{personId:l}}),g(null)},$=l=>{s==null||s(l),g(null)},R=B||((T=e[0])==null?void 0:T.id);return W&&y.isLoading?n.jsx(ae,{message:y.message||void 0,estimatedTime:y.estimatedTime}):n.jsxs("div",{ref:w,className:"bg-card relative h-full w-full overflow-hidden rounded-lg border",children:[n.jsx("svg",{ref:c,className:"h-full w-full"}),d&&R&&n.jsx(re,{node:d.node,position:d.position,rootPersonId:R,onSetAsCenter:$,onViewProfile:_,relationshipLabel:d.node.generation?`Generation ${d.node.generation}`:void 0})]})}const C=a.memo(ue),De={title:"Charts/DescendantChart"},me=()=>n.jsx(x,{children:n.jsx(C,{nodes:L.nodes,edges:L.edges,onNodeClick:e=>console.log("Clicked:",e)})});me.storyName="Default - 3 Generations";const ge=()=>{le();const e=ce(15,{generations:3}),m=de(e);return n.jsx(x,{children:n.jsx(C,{nodes:e,edges:m,onNodeClick:s=>console.log("Clicked:",s)})})};ge.storyName="Three Generations - Basic View";const fe=()=>n.jsx(x,{children:n.jsx(C,{nodes:A.nodes,edges:A.edges,onNodeClick:e=>console.log("Clicked:",e)})});fe.storyName="Ten Generations - Many Generations";const pe=()=>n.jsx(x,{children:n.jsx(C,{nodes:H.nodes,edges:H.edges,onNodeClick:e=>console.log("Clicked:",e)})});pe.storyName="No Children - Person with No Descendants";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{me as Default,pe as NoChildren,fe as TenGenerations,ge as ThreeGenerations,De as default};
