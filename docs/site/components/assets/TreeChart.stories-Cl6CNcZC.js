import{r as p,j as a}from"./index-B-j1UC9_.js";import{s as X,c as ee,r as te,a as oe,b as se,e as V}from"./d3-utils-RO1_HbsM.js";import{u as ne,a as re,b as ae}from"./chart-performance-BaH3yzFL.js";import{C as ie}from"./ChartTooltip-O9xYVHal.js";import{C as ce}from"./ChartSkeleton-B4IOvdG_.js";import{u as de}from"./useNavigate-C7g4pSHn.js";import{S as j}from"./decorators-CfDSmGYB.js";import{S as Y,E as Z,L as k,D as z,j as U}from"./chart-data-BkDdS-S9.js";import"./zoom-BhWAVBVM.js";import"./string-Quv1MC-p.js";import"./nav-CtgBGWHp.js";import"./createLucideIcon-BBWb6tWq.js";const w=180,ue=60,q=40,J=200,le=120;function fe(e){const i=new Map;return e.forEach(t=>{const r=t.generation??0;i.has(r)||i.set(r,[]),i.get(r).push(t)}),i.forEach(t=>{t.sort((r,m)=>!r.dateOfBirth&&!m.dateOfBirth?0:r.dateOfBirth?m.dateOfBirth?r.dateOfBirth.localeCompare(m.dateOfBirth):-1:1)}),i}function pe(e,i){const t=new Map,r=fe(e),m=i.filter(n=>n.type==="spouse"),l=new Map;m.forEach(n=>{l.set(n.source,n.target),l.set(n.target,n.source)});const g=Array.from(r.keys()).sort((n,y)=>n-y),v=g.find(n=>n===0)??g[Math.floor(g.length/2)];return g.forEach(n=>{const y=r.get(n),E=(n-v)*le,o=[],f=new Set;y.forEach(s=>{if(f.has(s.id))return;f.add(s.id);const h=l.get(s.id),d=h?y.find(M=>M.id===h):null;d&&!f.has(d.id)?(f.add(d.id),o.push({primary:s,spouse:d})):o.push({primary:s,spouse:null})});const T=o.map(s=>s.spouse?w*2+J:w);let x=-(T.reduce((s,h)=>s+h,0)+(o.length-1)*q)/2;o.forEach((s,h)=>{const d=T[h];s.spouse?(t.set(s.primary.id,{x:x+w/2,y:E}),t.set(s.spouse.id,{x:x+w/2+w+J-w,y:E})):t.set(s.primary.id,{x:x+d/2,y:E}),x+=d+q})}),t}function me({nodes:e,edges:i,onNodeClick:t,rootPersonId:r,resetSignal:m}){var M;const l=p.useRef(null),g=p.useRef(null),v=de(),[n,y]=p.useState(!0),E=p.useRef(),[o,f]=p.useState(null);ne("TreeChart",!1);const T=re(e.length),D=ae(()=>{},16),x=p.useMemo(()=>({nodeWidth:w,nodeHeight:ue,margin:{top:60,right:60,bottom:60,left:60}}),[]);p.useEffect(()=>{if(!l.current||!g.current||e.length===0)return;performance.now(),y(!0);const A=setTimeout(()=>{const G=g.current;if(!G||!l.current)return;const I=G.clientWidth,N=Math.max(600,G.clientHeight),B=X(l,I,N);if(!B)return;const{svg:P,g:C}=B,H=ee(P,C,[.1,4],D),{nodeWidth:b,nodeHeight:O,margin:W}=x,_=pe(e,i),$=C.append("g").attr("class","edges");i.forEach(c=>{const u=_.get(c.source),R=_.get(c.target);!u||!R||(c.type==="parent-child"?te($,u,R,O):c.type==="spouse"&&oe($,u,R,b))});const K=C.append("g").attr("class","nodes");e.forEach(c=>{const u=_.get(c.id);if(!u)return;const R=c.id===r,Q=K.append("g").attr("class","node").attr("transform",`translate(${u.x-b/2}, ${u.y-O/2})`).attr("role","button").attr("tabindex",0).style("cursor","pointer").on("click",()=>t==null?void 0:t(c.id)).on("keydown",S=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),t==null||t(c.id))}).on("mouseover",()=>{var F;const S=(F=l.current)==null?void 0:F.getBoundingClientRect();S&&f({node:c,position:{x:S.left+u.x,y:S.top+u.y}})}).on("mouseout",()=>{f(null)});se(Q,c,u,{width:b,height:O,borderRadius:8,isRoot:R})}),V(P,C,H,I,N,W),E.current=()=>{V(P,C,H,I,N,W)},performance.now(),y(!1)},0);return()=>clearTimeout(A)},[e,i,t,r,x,D]),p.useEffect(()=>{m!==void 0&&E.current&&E.current()},[m]);const s=A=>{v({to:"/people/$personId",params:{personId:A}}),f(null)},h=A=>{t==null||t(A),f(null)},d=r||((M=e[0])==null?void 0:M.id);return n&&T.isLoading?a.jsx(ce,{message:T.message||void 0,estimatedTime:T.estimatedTime}):a.jsxs("div",{ref:g,className:"bg-card relative h-full w-full overflow-hidden rounded-lg border",children:[a.jsx("svg",{ref:l,className:"h-full w-full"}),o&&d&&a.jsx(ie,{node:o.node,position:o.position,rootPersonId:d,onSetAsCenter:h,onViewProfile:s,relationshipLabel:o.node.generation!==void 0?o.node.generation===0?"Center":o.node.generation<0?`${Math.abs(o.node.generation)} generation${Math.abs(o.node.generation)>1?"s":""} up`:`${o.node.generation} generation${o.node.generation>1?"s":""} down`:void 0})]})}const L=p.memo(me),Ie={title:"Charts/TreeChart"},ge=()=>a.jsx(j,{children:a.jsx(L,{nodes:Y.nodes,edges:Y.edges,onNodeClick:e=>console.log("Clicked:",e)})});ge.storyName="Default - Small Family";const he=()=>a.jsx(j,{children:a.jsx(L,{nodes:Z.nodes,edges:Z.edges,onNodeClick:e=>console.log("Clicked:",e)})});he.storyName="Empty - No Data";const ye=()=>a.jsx(j,{children:a.jsx(L,{nodes:k.nodes,edges:k.edges,onNodeClick:e=>console.log("Clicked:",e)})});ye.storyName="Large Family - 50+ People";const Ee=()=>a.jsx(j,{children:a.jsx(L,{nodes:z.nodes,edges:z.edges,onNodeClick:e=>console.log("Clicked:",e)})});Ee.storyName="Deep Ancestry - 10 Generations";const xe=()=>a.jsx(j,{children:a.jsx(L,{nodes:U.nodes,edges:U.edges,onNodeClick:e=>console.log("Clicked:",e)})});xe.storyName="Long Names - Name Truncation Test";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{Ee as DeepAncestryStory,ge as Default,he as Empty,ye as LargeFamily,xe as LongNamesStory,Ie as default};
