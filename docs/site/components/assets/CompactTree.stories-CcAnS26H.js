import{j as t,r as a}from"./index-B-j1UC9_.js";import{c as _,a as Q,I as Y,B as I}from"./nav-CtgBGWHp.js";import{S as p}from"./decorators-CfDSmGYB.js";import{f as g}from"./chart-data-BkDdS-S9.js";import"./createLucideIcon-BBWb6tWq.js";const U=Q("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold tracking-wide transition-colors",{variants:{variant:{default:"bg-primary/20 text-primary border border-primary/30",secondary:"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-400 border border-green-400 dark:border-green-700",destructive:"bg-destructive/20 text-destructive border border-destructive/30",outline:"bg-amber-50 dark:bg-amber-950 text-amber-800 dark:text-amber-400 border border-amber-300 dark:border-amber-700",muted:"bg-muted/80 text-muted-foreground border border-transparent"}},defaultVariants:{variant:"default"}});function M({className:r,variant:n,...d}){return t.jsx("div",{className:_(U({variant:n}),r),...d})}const f=48,Z=24;function b({data:r,onNodeClick:n}){const[d,G]=a.useState(""),[h,x]=a.useState(new Set),[o,m]=a.useState(-1),k=a.useRef(null),v=a.useRef(null),[j,T]=a.useState(0),[w,A]=a.useState(600);a.useEffect(()=>{r.root&&x(new Set([r.root.id]))},[r.root]);const C=a.useMemo(()=>{const e=[],s=new Set;function c(l,L){if(s.has(l.id))return;s.add(l.id);const D=h.has(l.id),P=d===""||`${l.firstName} ${l.lastName}`.toLowerCase().includes(d.toLowerCase());e.push({...l,depth:L,isExpanded:D,isVisible:P||d===""}),D&&r.flatList.filter(S=>S.parentId===l.id).forEach(S=>c(S,L+1))}const u=r.flatList.find(l=>l.parentId===null);return u&&c(u,0),e},[r.flatList,h,d]),i=a.useMemo(()=>d===""?C:C.filter(e=>e.isVisible),[C,d]),R=i.length*f,y=Math.floor(j/f),B=Math.ceil(w/f)+2,$=Math.min(y+B,i.length),F=y*f,H=i.slice(y,$);a.useEffect(()=>{if(!k.current)return;const e=new ResizeObserver(s=>{for(const c of s)A(c.contentRect.height)});return e.observe(k.current),()=>e.disconnect()},[]);const O=a.useCallback(e=>{T(e.currentTarget.scrollTop)},[]),N=a.useCallback(e=>{x(s=>{const c=new Set(s);return c.has(e)?c.delete(e):c.add(e),c})},[]),W=a.useCallback(()=>{const e=r.flatList.filter(s=>s.hasChildren).map(s=>s.id);x(new Set(e))},[r.flatList]),V=a.useCallback(()=>{r.root?x(new Set([r.root.id])):x(new Set)},[r.root]),z=a.useCallback(e=>{if(i.length!==0)switch(e.key){case"ArrowDown":e.preventDefault(),m(s=>Math.min(s+1,i.length-1));break;case"ArrowUp":e.preventDefault(),m(s=>Math.max(s-1,0));break;case"ArrowRight":if(e.preventDefault(),o>=0&&o<i.length){const s=i[o];s.hasChildren&&!h.has(s.id)&&N(s.id)}break;case"ArrowLeft":if(e.preventDefault(),o>=0&&o<i.length){const s=i[o];if(h.has(s.id))N(s.id);else if(s.parentId){const c=i.findIndex(u=>u.id===s.parentId);c>=0&&m(c)}}break;case"Enter":case" ":if(e.preventDefault(),o>=0&&o<i.length){const s=i[o];n==null||n(s.id)}break;case"Home":e.preventDefault(),m(0);break;case"End":e.preventDefault(),m(i.length-1);break}},[i,o,h,N,n]);a.useEffect(()=>{if(o>=0&&v.current){const e=o*f,s=e+f;e<j?v.current.scrollTop=e:s>j+w&&(v.current.scrollTop=s-w)}},[o,j,w]);const E=e=>e?new Date(e).getFullYear().toString():"",K=e=>["Root","1st Gen","2nd Gen","3rd Gen","4th Gen","5th Gen","6th Gen","7th Gen","8th Gen","9th Gen","10th Gen"][e]||`${e}th Gen`;return r.root?t.jsxs("div",{className:"bg-card flex h-full flex-col rounded-lg border",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3 border-b p-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx(Y,{type:"search",placeholder:"Search by name...",value:d,onChange:e=>G(e.target.value),className:"max-w-xs"})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(I,{variant:"outline",size:"sm",onClick:W,children:[t.jsx("svg",{className:"mr-1 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Expand All"]}),t.jsxs(I,{variant:"outline",size:"sm",onClick:V,children:[t.jsx("svg",{className:"mr-1 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Collapse All"]})]}),t.jsxs("div",{className:"text-muted-foreground text-sm",children:[i.length," of ",r.flatList.length," visible"]})]}),t.jsx("div",{ref:k,className:"relative flex-1 overflow-hidden",role:"tree","aria-label":"Family tree",tabIndex:0,onKeyDown:z,children:t.jsx("div",{ref:v,className:"absolute inset-0 overflow-auto",onScroll:O,children:t.jsx("div",{style:{height:R,position:"relative"},children:t.jsx("div",{style:{position:"absolute",top:F,left:0,right:0},children:H.map((e,s)=>{const u=y+s===o;return t.jsxs("div",{role:"treeitem","aria-expanded":e.hasChildren?e.isExpanded:void 0,"aria-level":e.depth+1,"aria-selected":u,tabIndex:u?0:-1,className:`flex h-12 cursor-pointer items-center gap-2 px-4 transition-colors ${u?"bg-accent":"hover:bg-muted/50"}`,style:{paddingLeft:16+e.depth*Z},onClick:()=>n==null?void 0:n(e.id),onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),n==null||n(e.id))},children:[t.jsx("button",{type:"button",className:`flex h-6 w-6 flex-shrink-0 items-center justify-center rounded transition-colors ${e.hasChildren?"hover:bg-muted":"invisible"}`,onClick:l=>{l.stopPropagation(),e.hasChildren&&N(e.id)},tabIndex:-1,children:e.hasChildren&&t.jsx("svg",{className:`h-4 w-4 transition-transform ${e.isExpanded?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),t.jsx("div",{className:`h-2 w-2 flex-shrink-0 rounded-full ${e.isLiving?"bg-primary":"bg-muted-foreground"}`}),t.jsx("span",{className:"text-muted-foreground w-4 flex-shrink-0 text-xs",children:e.gender==="MALE"?"M":e.gender==="FEMALE"?"F":"-"}),t.jsxs("span",{className:"flex-1 truncate font-medium",children:[e.firstName," ",e.lastName]}),e.spouseCount>0&&t.jsxs(M,{variant:"secondary",className:"flex-shrink-0",children:[e.spouseCount," spouse",e.spouseCount>1?"s":""]}),t.jsxs("span",{className:"text-muted-foreground flex-shrink-0 text-sm",children:[E(e.dateOfBirth),e.dateOfBirth&&!e.isLiving&&" - ",!e.isLiving&&E(e.dateOfPassing)]}),t.jsx(M,{variant:"outline",className:"flex-shrink-0 text-xs",children:K(e.generation)})]},e.id)})})})})}),t.jsxs("div",{className:"text-muted-foreground flex items-center justify-between border-t p-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium",children:r.metadata.totalPeople})," ","people across"," ",t.jsx("span",{className:"font-medium",children:r.metadata.totalGenerations})," ","generations"]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"bg-primary h-2 w-2 rounded-full"}),t.jsx("span",{children:"Living"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"bg-muted-foreground h-2 w-2 rounded-full"}),t.jsx("span",{children:"Deceased"})]})]})]})]}):t.jsx("div",{className:"bg-card flex h-full items-center justify-center rounded-lg border p-8",children:t.jsx("p",{className:"text-muted-foreground",children:"No tree data available"})})}const oe={title:"Charts/CompactTree"},q=()=>{const r=g(3,3);return t.jsx(p,{children:t.jsx(b,{data:r,onNodeClick:n=>console.log("Clicked:",n)})})};q.storyName="Default - Standard tree view";const J=()=>{const r=g(2,2);return t.jsx(p,{children:t.jsx(b,{data:r,onNodeClick:n=>console.log("Clicked:",n)})})};J.storyName="Collapsed - Small tree (few nodes)";const X=()=>{const r=g(4,4);return t.jsx(p,{children:t.jsx(b,{data:r,onNodeClick:n=>console.log("Clicked:",n)})})};X.storyName="Expanded - All nodes expanded";const ee=()=>{const r=g(10,2);return t.jsx(p,{children:t.jsx(b,{data:r,onNodeClick:n=>console.log("Clicked:",n)})})};ee.storyName="Deep Nesting - Many generations deep";const te=()=>{const r=g(3,8);return t.jsx(p,{children:t.jsx(b,{data:r,onNodeClick:n=>console.log("Clicked:",n)})})};te.storyName="Many Siblings - Wide family";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{J as Collapsed,ee as DeepNesting,q as Default,X as Expanded,te as ManySiblings,oe as default};
