# E2E Test Workflow Coverage

This document tracks the E2E test coverage for the Vamsa genealogy application. It is automatically generated by running:

```bash
bun run apps/web/e2e/scripts/analyze-coverage.ts
```

## Current Test Suite

### Authentication & Access Control

**File**: `auth.spec.ts`

- âœ… Login with valid credentials
- âœ… Login with invalid credentials displays error
- âœ… Logout successfully
- âœ… Session persistence
- âœ… Protected routes redirect to login
- âœ… Access control for different user roles

**Coverage**: ~6 scenarios

---

### User Registration

**File**: `register.spec.ts`

- âœ… Register new user with valid data
- âœ… Email validation
- âœ… Password strength validation
- âœ… Duplicate email error handling
- âœ… Required field validation
- âœ… Successful registration redirects to login

**Coverage**: ~6 scenarios

---

### Password Management

**File**: `change-password.spec.ts`

- âœ… Change password successfully
- âœ… Old password validation
- âœ… New password validation
- âœ… Password confirmation match
- âœ… Session remains valid after password change

**Coverage**: ~5 scenarios

---

### Profile Claiming

**File**: `claim-profile.spec.ts`

- âœ… Claim profile workflow
- âœ… Profile search and selection
- âœ… Validation before claiming
- âœ… Cannot claim already-claimed profile
- âœ… Promotion to MEMBER role after claiming

**Coverage**: ~5 scenarios

---

### OIDC Profile Claiming

**File**: `oidc-profile-claim.spec.ts`

- âœ… Profile claim modal appears for PENDING users
- âœ… Suggested matches displayed first
- âœ… Search and filter profiles
- âœ… Claim profile from modal
- âœ… Skip profile claiming
- âœ… Claim from settings page later
- âœ… Modal doesn't show for claimed users
- âœ… Auto-promotion to MEMBER role

**Coverage**: ~31 scenarios (comprehensive)

---

### People Management

**File**: `people.spec.ts`

- âœ… View people list
- âœ… Search people by name
- âœ… Filter living/deceased
- âœ… Navigate to person detail
- âœ… Pagination handling

**Coverage**: ~5 scenarios

**File**: `person-forms.spec.ts`

- âœ… Create new person with basic info
- âœ… Edit existing person
- âœ… Add biographical details
- âœ… Add dates and events
- âœ… Form validation
- âœ… Save and cancel actions

**Coverage**: ~8 scenarios

---

### Relationship Management

**File**: `relationships.spec.ts`

- âœ… Add parent relationship
- âœ… Add spouse relationship
- âœ… Add child relationship
- âœ… Add sibling relationship
- âœ… Edit relationship details
- âœ… Delete relationship (with confirmation)
- âœ… Validate relationship constraints
- âœ… Derived relationship calculation
- âœ… Complex family structures

**Coverage**: ~25+ scenarios (most comprehensive)

---

### Family Tree Visualization

**File**: `tree.spec.ts`

- âœ… Render family tree with ReactFlow
- âœ… Navigate tree (zoom, pan, fit view)
- âœ… Expand/collapse person nodes
- âœ… Display relationship lines correctly
- âœ… Node interactions (click, hover)
- âœ… Add person from tree view
- âœ… Add relationship from tree view
- âœ… Performance with large trees

**Coverage**: ~12 scenarios

---

### Data Import/Export

**File**: `backup.spec.ts`

- âœ… Import GEDCOM file
- âœ… Validate GEDCOM structure
- âœ… Handle import errors
- âœ… Preview import results
- âœ… Export GEDCOM
- âœ… Create full backup
- âœ… Restore from backup
- âœ… Selective restore options

**Coverage**: ~15 scenarios

---

### Admin Functions

**File**: `admin.spec.ts`

- âœ… View all users
- âœ… Change user roles
- âœ… Enable/disable user accounts
- âœ… View user activity logs
- âœ… Manage invitations
- âœ… Review merge suggestions
- âœ… Admin-only route protection

**Coverage**: ~7 scenarios

---

### Dashboard

**File**: `dashboard.spec.ts`

- âœ… Display dashboard overview
- âœ… Show recent activity
- âœ… Quick stats (people count, relationships, etc.)
- âœ… Quick actions shortcuts
- âœ… Role-based dashboard content

**Coverage**: ~5 scenarios

---

### Internationalization

**File**: `i18n-language-switching.spec.ts`

- âœ… Language selector visible on pages
- âœ… Switch language updates UI
- âœ… Error messages in selected language
- âœ… Form validation messages localized
- âœ… Language preference persistence
- âœ… Accept-Language header support
- âœ… Fallback to English for missing translations

**Coverage**: ~13 scenarios

---

## Summary Statistics

| Metric                        | Value                             |
| ----------------------------- | --------------------------------- |
| **Total Test Files**          | 17                                |
| **Estimated Total Scenarios** | ~110                              |
| **Feature Areas Covered**     | 12                                |
| **Execution Time**            | ~3 minutes                        |
| **Pass Rate**                 | ~100% (when all dependencies met) |

## Workflow Gaps & Future Coverage

### High Priority (Missing Critical Workflows)

#### Email Notifications

- [ ] Welcome email after registration
- [ ] Password reset email workflow
- [ ] Invitation email delivery
- [ ] Notification preferences

#### Search & Filtering

- [ ] Advanced people search
- [ ] Filter by relationship type
- [ ] Filter by date ranges
- [ ] Saved search preferences

#### Data Validation

- [ ] Duplicate person detection
- [ ] Data consistency checks
- [ ] Circular relationship prevention
- [ ] Date validation (birth < death, etc.)

### Medium Priority (Nice to Have)

#### Accessibility

- [ ] Keyboard navigation throughout app
- [ ] Screen reader compatibility
- [ ] Focus management
- [ ] ARIA labels validation

#### Performance

- [ ] Large dataset handling (1000+ people)
- [ ] Concurrent user operations
- [ ] Network failure recovery
- [ ] Offline functionality

#### Mobile Responsiveness

- [ ] Mobile layout adaptation
- [ ] Touch gestures (tree navigation)
- [ ] Mobile form inputs
- [ ] Responsive table views

### Low Priority (Edge Cases)

#### Error Recovery

- [ ] Network timeout handling
- [ ] Database connection loss
- [ ] Concurrent edit conflicts
- [ ] Browser back button behavior

#### Edge Cases

- [ ] Unicode character support
- [ ] Very long names/descriptions
- [ ] Special characters in input
- [ ] Timezone handling

## Test Maintenance

### Recently Added (2026-01)

- âœ… OIDC profile claiming workflows (31 scenarios)
- âœ… Internationalization testing (13 scenarios)
- âœ… Enhanced tree visualization tests
- âœ… Backup/restore comprehensive coverage

### Recently Optimized (2026-01)

- ðŸš€ Reduced test suite from 158 to ~110 tests (focused on real workflows)
- ðŸš€ Execution time: 45min â†’ 3min (92% faster)
- ðŸš€ Code size: 5,170 â†’ 2,390 lines (54% reduction)
- ðŸš€ Eliminated flaky visual/benchmark tests

### Next Review Date

**2026-02-15** - Quarterly test suite audit

## Contributing to Test Coverage

When adding new features, ensure E2E tests are added covering:

1. **Happy path** - Primary user workflow succeeds
2. **Error cases** - Invalid input, validation errors
3. **Edge cases** - Boundary conditions, empty states
4. **Permissions** - Role-based access control
5. **Persistence** - Data saved correctly, survives reload

See [README.md](./README.md) for testing guidelines and best practices.

---

_Last updated: 2026-01-13_
_Generate fresh report: `bun run apps/web/e2e/scripts/analyze-coverage.ts`_
