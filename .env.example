# ============================================
# DATABASE
# ============================================
DATABASE_URL="postgresql://vamsa:password@localhost:5432/vamsa"

# Connection Pool Configuration (optional, sensible defaults provided)
# DB_POOL_MAX=10        # Maximum concurrent connections
# DB_POOL_MIN=2         # Minimum idle connections
# DB_POOL_IDLE_TIMEOUT=30000      # Close idle connections after ms
# DB_POOL_CONNECTION_TIMEOUT=10000 # Fail if can't connect in ms

# ============================================
# DATABASE SSL
# ============================================
# SSL mode for database connection:
#   "disable"     - No SSL (default for Docker same-host)
#   "require"     - SSL required, no certificate validation
#   "verify-ca"   - SSL required, validate against CA certificate
#   "verify-full" - SSL + hostname validation (most secure)
# DB_SSL_MODE=disable
#
# Path to CA certificate (required for verify-ca and verify-full):
#   AWS RDS: https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem
#   Supabase: Available in project dashboard
# DB_SSL_CA_CERT=/path/to/ca-certificate.pem

# ============================================
# AUTHENTICATION (Better Auth)
# ============================================
# Generate secret with: openssl rand -base64 32
BETTER_AUTH_SECRET="your-32-character-secret-here-change-in-production"
BETTER_AUTH_URL="http://localhost:3000"

# Initial Admin (required for seeding)
ADMIN_EMAIL="admin@vamsa.local"
ADMIN_PASSWORD=""  # Leave empty to auto-generate a secure password

# ============================================
# OAUTH PROVIDERS (all optional)
# ============================================

# Google OAuth (https://console.cloud.google.com/apis/credentials)
GOOGLE_CLIENT_ID=""
GOOGLE_CLIENT_SECRET=""

# Microsoft OAuth (https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps)
MICROSOFT_CLIENT_ID=""
MICROSOFT_CLIENT_SECRET=""
MICROSOFT_TENANT_ID="common"

# GitHub OAuth (https://github.com/settings/developers)
GITHUB_CLIENT_ID=""
GITHUB_CLIENT_SECRET=""

# Self-hosted OIDC (Authentik, Keycloak, etc.)
OIDC_DISCOVERY_URL=""
OIDC_CLIENT_ID=""
OIDC_CLIENT_SECRET=""

# App URL for OAuth callbacks
APP_URL="http://localhost:3000"

# ============================================
# EMAIL (Resend)
# ============================================
RESEND_API_KEY=""
EMAIL_FROM="noreply@vamsa.family"

# ============================================
# STORAGE (S3-compatible cloud backup)
# ============================================
# Works with AWS S3, Cloudflare R2, Backblaze B2
S3_ENDPOINT=""           # Leave empty for AWS S3
S3_ACCESS_KEY_ID=""
S3_SECRET_ACCESS_KEY=""
S3_REGION="auto"         # Use "auto" for R2

# ============================================
# OBSERVABILITY
# ============================================
LOG_LEVEL="info"  # debug | info | warn | error

# OpenTelemetry (optional)
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT="http://localhost:4318"
OTEL_SERVICE_NAME="vamsa-web"

# Grafana Stack URLs (for metrics dashboard links)
PROMETHEUS_URL="http://localhost:9090"
GRAFANA_URL="http://localhost:3001"
GRAFANA_PASSWORD="admin"

# Metrics endpoint authentication (required in production)
# Protects /health/cache and /health/telemetry endpoints
# Generate with: openssl rand -hex 32
METRICS_BEARER_TOKEN=""

# ============================================
# TRUSTED PROXIES (for IP spoofing prevention)
# ============================================
# Comma-separated list of trusted proxy sources. Only proxy headers
# (X-Forwarded-For, X-Real-IP, CF-Connecting-IP) from these sources
# are used for client IP resolution. This prevents attackers from
# spoofing their IP address to bypass rate limits.
#
# Empty = trust nothing (safest default, no proxy headers used)
#
# Aliases:
#   loopback    → 127.0.0.0/8 + ::1
#   docker      → 172.16.0.0/12 + 10.0.0.0/8 + 192.168.0.0/16
#   linklocal   → 169.254.0.0/16 + fe80::/10
#   cloudflare  → All Cloudflare IP ranges
#
# Examples:
#   TRUSTED_PROXIES="127.0.0.1,::1"              # Localhost only
#   TRUSTED_PROXIES="loopback,docker"            # Loopback + Docker subnets
#   TRUSTED_PROXIES="cloudflare"                 # Cloudflare only
#   TRUSTED_PROXIES="10.0.0.0/8,172.16.0.0/12"   # Custom CIDR ranges
#   TRUSTED_PROXIES="127.0.0.1,10.0.0.0/8"       # Localhost + Docker
# TRUSTED_PROXIES=""

# ============================================
# RATE LIMITING (optional - uses in-memory by default)
# ============================================
# Set REDIS_URL for persistent rate limiting across server restarts
# and multi-instance deployments. Uses in-memory store if not set.
# Examples:
#   redis://localhost:6379
#   redis://:password@localhost:6379
#   redis://user:password@redis.example.com:6379
# REDIS_URL=""

# Rate limit configuration (all optional - sensible defaults provided)
# Format: RATE_LIMIT_{ACTION}_{MAX|WINDOW}
# _MAX: maximum requests allowed (integer)
# _WINDOW: time window in seconds (integer)
#
# LOGIN: Sign in attempts
# RATE_LIMIT_LOGIN_MAX=5           # Default: 5 attempts
# RATE_LIMIT_LOGIN_WINDOW=60       # Default: 60 seconds (1 minute)
#
# REGISTER: Sign up attempts
# RATE_LIMIT_REGISTER_MAX=3        # Default: 3 attempts
# RATE_LIMIT_REGISTER_WINDOW=3600  # Default: 3600 seconds (1 hour)
#
# CLAIM_PROFILE: Profile claim attempts
# RATE_LIMIT_CLAIM_PROFILE_MAX=10  # Default: 10 attempts
# RATE_LIMIT_CLAIM_PROFILE_WINDOW=3600  # Default: 3600 seconds (1 hour)
#
# PASSWORD_RESET: Password reset requests
# RATE_LIMIT_PASSWORD_RESET_MAX=3  # Default: 3 attempts
# RATE_LIMIT_PASSWORD_RESET_WINDOW=3600  # Default: 3600 seconds (1 hour)
#
# SEARCH: Search API requests
# RATE_LIMIT_SEARCH_MAX=30         # Default: 30 searches
# RATE_LIMIT_SEARCH_WINDOW=60      # Default: 60 seconds (1 minute)
#
# API: General API requests (/api/v1/*)
# Authenticated users use their user ID as the key.
# Anonymous users are rate limited by IP address.
# RATE_LIMIT_API_MAX=100           # Default: 100 requests
# RATE_LIMIT_API_WINDOW=60         # Default: 60 seconds (1 minute)

# ============================================
# DATABASE BACKUP
# ============================================
# Directory for storing database backups (local backups)
BACKUP_DIR="./backups"

# Docker Compose backup service configuration
# SCHEDULE: Cron expression for backup frequency (default: @daily = 00:00 UTC)
# @daily, @weekly, @monthly, @hourly, or cron format (0 0 * * *)
BACKUP_SCHEDULE="@daily"

# Retention periods (in days/weeks/months)
BACKUP_KEEP_DAYS=30        # Keep daily backups for 30 days
BACKUP_KEEP_WEEKS=4        # Keep weekly backups for 4 weeks
BACKUP_KEEP_MONTHS=6       # Keep monthly backups for 6 months

# ============================================
# API DOCUMENTATION
# ============================================
# Enable OpenAPI/Swagger docs even in production (default: only in development)
# Docs are always available in development. In production, set to "true" to enable.
# ENABLE_API_DOCS=true

# ============================================
# AI SERVICE (opt-in)
# ============================================
# Enable AI features by starting the AI service:
#   docker compose --profile ai up
# Or locally:
#   bun run dev:ai

# LLM provider: "ollama" (local), "openai", or "openai-compatible" (Groq, etc.)
LLM_PROVIDER="ollama"

# LLM endpoint URL
# Ollama default: http://localhost:11434/v1
# OpenAI: https://api.openai.com/v1
# Groq: https://api.groq.com/openai/v1
LLM_URL="http://localhost:11434/v1"

# Model name (depends on provider)
# Ollama: qwen2.5:1.5b, llama3.2:3b, mistral:7b
# OpenAI: gpt-4o-mini, gpt-4o
LLM_MODEL="qwen2.5:1.5b"

# API key (required for cloud providers, not needed for Ollama)
LLM_API_KEY=""

# AI service API key (optional, protects the AI service endpoint)
# Generate with: openssl rand -hex 32
AI_API_KEY=""

# Tool execution mode:
#   "direct" - AI service calls DB directly (faster, needs DATABASE_URL)
#   "http"   - AI service calls Vamsa web app API (isolated container mode)
# TOOL_MODE="direct"

# Vamsa app URL (for HTTP tool mode)
# VAMSA_APP_URL="http://localhost:3000"

# Main app connection to AI service (set in the main app, not in the AI service)
# Master switch: set to "true" to enable AI features in the UI
VAMSA_AI_ENABLED=false
# URL of the AI sidecar service
VAMSA_AI_URL="http://localhost:3100"

# ============================================
# DOCKER BUILD
# ============================================
# Skip SSL verification during Docker build (for corporate proxies like Zscaler)
# SKIP_SSL_VERIFY=true

# ============================================
# DOCKER DEPLOYMENT
# ============================================
# SECURITY: These values are REQUIRED for Docker deployment.
# The docker-compose.yml will fail to start without them.

# Database container
DB_USER=vamsa
# REQUIRED: Generate a strong password. Example: openssl rand -base64 24
DB_PASSWORD=
DB_NAME=vamsa
# NOTE: PostgreSQL is not exposed to the host in production.
# Access the database via: docker exec -it vamsa-db psql -U vamsa

# App port (host port that maps to container's 3000)
APP_PORT=80
